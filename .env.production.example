# Shade Production Configuration
# Copy this to .env.production and update all values
# NEVER commit .env.production to git!

# ============================================================================
# Core Settings
# ============================================================================

RUST_LOG=shade=info,tower_http=info

# Bind to all interfaces inside container (nginx on host will proxy)
SHADE_HOST=0.0.0.0
SHADE_PORT=8080

# IMPORTANT: Change these to your actual domain!
SHADE_ISSUER=https://auth.yourdomain.com
SHADE_EXTERNAL_URL=https://auth.yourdomain.com

# ============================================================================
# Security - CRITICAL: Generate secure secrets!
# ============================================================================

# Generate with: openssl rand -base64 64
SHADE_COOKIE_SECRET=base64:REPLACE_WITH_SECURE_SECRET_FROM_OPENSSL

# JWT algorithm (RS256 recommended for production)
SHADE_JWT_SIGNING_ALG=RS256

# Token lifetimes (in seconds)
SHADE_ACCESS_TOKEN_TTL=3600        # 1 hour
SHADE_REFRESH_TOKEN_TTL=2592000    # 30 days

# Security features
SHADE_REQUIRE_PKCE=true
SHADE_REFRESH_TOKEN_ROTATION=true
SHADE_MAX_FAILED_ATTEMPTS=5
SHADE_LOCKOUT_DURATION_MINUTES=15

# ============================================================================
# Database - PostgreSQL
# ============================================================================

# Internal docker network connection
DATABASE_URL=postgres://shade:STRONG_DB_PASSWORD_HERE@db:5432/shade
DATABASE_MAX_CONNECTIONS=20

# For docker-compose.prod.yml
POSTGRES_DB=shade
POSTGRES_USER=shade
POSTGRES_PASSWORD=STRONG_DB_PASSWORD_HERE

# ============================================================================
# Redis - Session Store
# ============================================================================

# Internal docker network connection
REDIS_URL=redis://:STRONG_REDIS_PASSWORD_HERE@redis:6379
REDIS_PASSWORD=STRONG_REDIS_PASSWORD_HERE

# ============================================================================
# Admin Bootstrap
# ============================================================================

# Initial admin user (created on first run)
SHADE_ADMIN_EMAIL=admin@yourdomain.com
SHADE_ADMIN_PASSWORD=CHANGE_ME_IMMEDIATELY_AFTER_FIRST_LOGIN

# ============================================================================
# OAuth Providers - Production URLs
# ============================================================================

# Google OAuth (for Claude Max subscription)
# Setup: https://console.cloud.google.com/
# - Create OAuth 2.0 Client ID (Web application)
# - Add authorized redirect URI: https://auth.yourdomain.com/callback/google
# - Copy Client ID and Secret below
OIDC_GOOGLE_CLIENT_ID=your_google_client_id.apps.googleusercontent.com
OIDC_GOOGLE_CLIENT_SECRET=your_google_client_secret
OIDC_GOOGLE_REDIRECT_URI=https://auth.yourdomain.com/callback/google

# GitHub OAuth (for Copilot Pro subscription)
# Setup: https://github.com/settings/developers
# - Create OAuth App
# - Set Homepage URL: https://auth.yourdomain.com
# - Set Authorization callback URL: https://auth.yourdomain.com/callback/github
# - Generate client secret
OIDC_GITHUB_CLIENT_ID=your_github_client_id
OIDC_GITHUB_CLIENT_SECRET=your_github_client_secret
OIDC_GITHUB_REDIRECT_URI=https://auth.yourdomain.com/callback/github

# Microsoft Entra ID (M365 SSO)
# Setup: https://portal.azure.com/
# - Register application in Azure AD
# - Add redirect URI (Web): https://auth.yourdomain.com/callback/entra
# - Create client secret
# - Note: Tenant ID, Application (client) ID
OIDC_ENTRA_TENANT_ID=your_tenant_id_here
OIDC_ENTRA_CLIENT_ID=your_entra_client_id_here
OIDC_ENTRA_CLIENT_SECRET=your_entra_client_secret_here
OIDC_ENTRA_REDIRECT_URI=https://auth.yourdomain.com/callback/entra

# ============================================================================
# Production Deployment Checklist
# ============================================================================
#
# [ ] Update SHADE_ISSUER and SHADE_EXTERNAL_URL to production domain
# [ ] Generate secure SHADE_COOKIE_SECRET (openssl rand -base64 64)
# [ ] Set strong POSTGRES_PASSWORD (openssl rand -base64 32)
# [ ] Set strong REDIS_PASSWORD (openssl rand -base64 32)
# [ ] Update all OAuth redirect URIs to production domain
# [ ] Update OAuth apps in provider consoles with production URLs
# [ ] Set strong SHADE_ADMIN_PASSWORD
# [ ] Configure nginx with valid SSL certificates
# [ ] Set up automated database backups
# [ ] Configure monitoring/alerting
# [ ] Test all OAuth flows
# [ ] Enable firewall rules
# [ ] Set up log aggregation
#
# ============================================================================
